{"ast":null,"code":"/* global require, exports */\n\n/* jshint strict:false, eqnull:true */\nvar request = require('request');\n\nvar errors = require('./errors');\n\nvar pkg = require('../package.json');\n\nvar _ = require('lodash');\n\nvar generateJwt = require('./generateJwt');\n\nvar api = function (config, method, session, connection, body, callback) {\n  var rurl = config.apiEndpoint + '/v2/project/' + config.apiKey + '/session/' + session;\n\n  if (connection) {\n    rurl += '/connection/' + connection;\n  }\n\n  rurl += '/signal';\n  request.defaults(_.pick(config, 'proxy', 'timeout'))({\n    url: rurl,\n    method: method,\n    headers: {\n      'X-OPENTOK-AUTH': generateJwt(config),\n      'User-Agent': 'OpenTok-Node-SDK/' + pkg.version + (config.uaAddendum ? ' ' + config.uaAddendum : '')\n    },\n    json: body\n  }, callback);\n};\n\nexports.signal = function (config, sessionId, connectionId, payload, callback) {\n  var options;\n\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  if (typeof callback !== 'function') {\n    throw new errors.ArgumentError('No callback given to signal');\n  }\n\n  if (sessionId == null || payload == null) {\n    return callback(new errors.ArgumentError('No sessionId or payload given to signal'));\n  }\n\n  return api(config, 'POST', sessionId, connectionId, payload, function (err, response) {\n    if (err || Math.floor(response.statusCode / 100) !== 2) {\n      if (response && response.statusCode === 403) {\n        callback(new errors.AuthError('Invalid API key or secret'));\n      } else if (response && response.statusCode === 404) {\n        callback(new errors.SignalError('Session or Connection not found'));\n      } else {\n        callback(new errors.RequestError('Unexpected response from OpenTok'));\n      }\n    } else {\n      callback(null);\n    }\n  });\n};","map":{"version":3,"names":["request","require","errors","pkg","_","generateJwt","api","config","method","session","connection","body","callback","rurl","apiEndpoint","apiKey","defaults","pick","url","headers","version","uaAddendum","json","exports","signal","sessionId","connectionId","payload","options","ArgumentError","err","response","Math","floor","statusCode","AuthError","SignalError","RequestError"],"sources":["/Users/megnabiederman/node_modules/opentok/lib/signaling.js"],"sourcesContent":["/* global require, exports */\n/* jshint strict:false, eqnull:true */\n\nvar request = require('request');\nvar errors = require('./errors');\nvar pkg = require('../package.json');\nvar _ = require('lodash');\nvar generateJwt = require('./generateJwt');\n\nvar api = function (config, method, session, connection, body, callback) {\n  var rurl = config.apiEndpoint + '/v2/project/' + config.apiKey + '/session/' + session;\n  if (connection) {\n    rurl += '/connection/' + connection;\n  }\n  rurl += '/signal';\n  request.defaults(_.pick(config, 'proxy', 'timeout'))({\n    url: rurl,\n    method: method,\n    headers: {\n      'X-OPENTOK-AUTH': generateJwt(config),\n      'User-Agent': 'OpenTok-Node-SDK/' + pkg.version +\n        (config.uaAddendum ? ' ' + config.uaAddendum : '')\n    },\n    json: body\n  }, callback);\n};\n\nexports.signal = function (config, sessionId, connectionId, payload, callback) {\n  var options;\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  if (typeof callback !== 'function') {\n    throw (new errors.ArgumentError('No callback given to signal'));\n  }\n  if (sessionId == null || payload == null) {\n    return callback(new errors.ArgumentError('No sessionId or payload given to signal'));\n  }\n  return api(config, 'POST', sessionId, connectionId, payload, function (err, response) {\n    if (err || Math.floor(response.statusCode / 100) !== 2) {\n      if (response && response.statusCode === 403) {\n        callback(new errors.AuthError('Invalid API key or secret'));\n      }\n      else if (response && response.statusCode === 404) {\n        callback(new errors.SignalError('Session or Connection not found'));\n      }\n      else {\n        callback(new errors.RequestError('Unexpected response from OpenTok'));\n      }\n    }\n    else {\n      callback(null);\n    }\n  });\n};\n"],"mappings":"AAAA;;AACA;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,UAAD,CAApB;;AACA,IAAIE,GAAG,GAAGF,OAAO,CAAC,iBAAD,CAAjB;;AACA,IAAIG,CAAC,GAAGH,OAAO,CAAC,QAAD,CAAf;;AACA,IAAII,WAAW,GAAGJ,OAAO,CAAC,eAAD,CAAzB;;AAEA,IAAIK,GAAG,GAAG,UAAUC,MAAV,EAAkBC,MAAlB,EAA0BC,OAA1B,EAAmCC,UAAnC,EAA+CC,IAA/C,EAAqDC,QAArD,EAA+D;EACvE,IAAIC,IAAI,GAAGN,MAAM,CAACO,WAAP,GAAqB,cAArB,GAAsCP,MAAM,CAACQ,MAA7C,GAAsD,WAAtD,GAAoEN,OAA/E;;EACA,IAAIC,UAAJ,EAAgB;IACdG,IAAI,IAAI,iBAAiBH,UAAzB;EACD;;EACDG,IAAI,IAAI,SAAR;EACAb,OAAO,CAACgB,QAAR,CAAiBZ,CAAC,CAACa,IAAF,CAAOV,MAAP,EAAe,OAAf,EAAwB,SAAxB,CAAjB,EAAqD;IACnDW,GAAG,EAAEL,IAD8C;IAEnDL,MAAM,EAAEA,MAF2C;IAGnDW,OAAO,EAAE;MACP,kBAAkBd,WAAW,CAACE,MAAD,CADtB;MAEP,cAAc,sBAAsBJ,GAAG,CAACiB,OAA1B,IACXb,MAAM,CAACc,UAAP,GAAoB,MAAMd,MAAM,CAACc,UAAjC,GAA8C,EADnC;IAFP,CAH0C;IAQnDC,IAAI,EAAEX;EAR6C,CAArD,EASGC,QATH;AAUD,CAhBD;;AAkBAW,OAAO,CAACC,MAAR,GAAiB,UAAUjB,MAAV,EAAkBkB,SAAlB,EAA6BC,YAA7B,EAA2CC,OAA3C,EAAoDf,QAApD,EAA8D;EAC7E,IAAIgB,OAAJ;;EACA,IAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;IACjChB,QAAQ,GAAGgB,OAAX;IACAA,OAAO,GAAG,EAAV;EACD;;EACD,IAAI,OAAOhB,QAAP,KAAoB,UAAxB,EAAoC;IAClC,MAAO,IAAIV,MAAM,CAAC2B,aAAX,CAAyB,6BAAzB,CAAP;EACD;;EACD,IAAIJ,SAAS,IAAI,IAAb,IAAqBE,OAAO,IAAI,IAApC,EAA0C;IACxC,OAAOf,QAAQ,CAAC,IAAIV,MAAM,CAAC2B,aAAX,CAAyB,yCAAzB,CAAD,CAAf;EACD;;EACD,OAAOvB,GAAG,CAACC,MAAD,EAAS,MAAT,EAAiBkB,SAAjB,EAA4BC,YAA5B,EAA0CC,OAA1C,EAAmD,UAAUG,GAAV,EAAeC,QAAf,EAAyB;IACpF,IAAID,GAAG,IAAIE,IAAI,CAACC,KAAL,CAAWF,QAAQ,CAACG,UAAT,GAAsB,GAAjC,MAA0C,CAArD,EAAwD;MACtD,IAAIH,QAAQ,IAAIA,QAAQ,CAACG,UAAT,KAAwB,GAAxC,EAA6C;QAC3CtB,QAAQ,CAAC,IAAIV,MAAM,CAACiC,SAAX,CAAqB,2BAArB,CAAD,CAAR;MACD,CAFD,MAGK,IAAIJ,QAAQ,IAAIA,QAAQ,CAACG,UAAT,KAAwB,GAAxC,EAA6C;QAChDtB,QAAQ,CAAC,IAAIV,MAAM,CAACkC,WAAX,CAAuB,iCAAvB,CAAD,CAAR;MACD,CAFI,MAGA;QACHxB,QAAQ,CAAC,IAAIV,MAAM,CAACmC,YAAX,CAAwB,kCAAxB,CAAD,CAAR;MACD;IACF,CAVD,MAWK;MACHzB,QAAQ,CAAC,IAAD,CAAR;IACD;EACF,CAfS,CAAV;AAgBD,CA5BD"},"metadata":{},"sourceType":"script"}