{"ast":null,"code":"/* global require, exports */\n\n/* jshint strict:false, eqnull:true */\nvar request = require('request');\n\nvar errors = require('./errors');\n\nvar pkg = require('../package.json');\n\nvar _ = require('lodash');\n\nvar generateJwt = require('./generateJwt');\n\nvar api = function (config, method, path, body, callback) {\n  var rurl = config.apiEndpoint + '/v2/project/' + config.apiKey + path;\n  request.defaults(_.pick(config, 'proxy', 'timeout'))({\n    url: rurl,\n    method: method,\n    headers: {\n      'X-OPENTOK-AUTH': generateJwt(config),\n      'User-Agent': 'OpenTok-Node-SDK/' + pkg.version + (config.uaAddendum ? ' ' + config.uaAddendum : '')\n    },\n    json: body\n  }, callback);\n};\n\nfunction Callback(config, properties) {\n  var hasProp = {}.hasOwnProperty;\n  var id = properties.id;\n  var key;\n\n  for (key in properties) {\n    if (hasProp.call(properties, key)) this[key] = properties[key];\n  }\n\n  this.unregister = function (callback) {\n    exports.unregister(config, id, callback);\n  };\n}\n\nexports.listCallbacks = function (config, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  if (typeof callback !== 'function') {\n    throw new errors.ArgumentError('No callback given to listCallbacks');\n  }\n\n  api(config, 'GET', '/callback', null, function (err, response, body) {\n    if (!err && body) {\n      try {\n        body = JSON.parse(body);\n      } catch (_err) {\n        err = _err;\n      }\n    }\n\n    if (err || Math.floor(response.statusCode / 100) !== 2) {\n      if (response && response.statusCode === 403) {\n        callback(new errors.AuthError('Invalid API key or secret'));\n      } else {\n        callback(new errors.RequestError('Unexpected response from OpenTok'));\n      }\n    } else {\n      callback(null, body.map(function (item) {\n        return new Callback(config, item);\n      }));\n    }\n  });\n};\n\nexports.registerCallback = function (config, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  if (typeof callback !== 'function') {\n    throw new errors.ArgumentError('No callback given to registerCallback');\n  }\n\n  api(config, 'POST', '/callback', {\n    group: options.group,\n    event: options.event,\n    url: options.url\n  }, function apiCallback(err, response, body) {\n    if (err) {\n      callback(err);\n    } else if (Math.floor(response.statusCode / 100) !== 2) {\n      if (response && response.statusCode === 404) {\n        callback(new errors.CallbackError('Callback event not found'));\n      } else if (response && response.statusCode === 403) {\n        callback(new errors.AuthError('Invalid API key or secret'));\n      } else {\n        callback(new errors.RequestError('Unexpected response from OpenTok'));\n      }\n    } else {\n      callback(null, new Callback(config, body));\n    }\n  });\n};\n\nexports.unregisterCallback = function (config, callbackId, callback) {\n  if (typeof callback !== 'function') {\n    throw new errors.ArgumentError('No callback given to unregisterCallback');\n  }\n\n  if (callbackId == null || callbackId.length === 0) {\n    callback(new errors.ArgumentError('No callback ID given'));\n    return;\n  }\n\n  api(config, 'DELETE', '/callback/' + encodeURIComponent(callbackId), {}, function (err, response) {\n    if (err) {\n      callback(err);\n    } else if (Math.floor(response.statusCode / 100) !== 2) {\n      if (response && response.statusCode === 404) {\n        callback(new errors.CallbackError('Callback not found'));\n      } else if (response && response.statusCode === 403) {\n        callback(new errors.AuthError('Invalid API key or secret'));\n      } else {\n        callback(new errors.RequestError('Unexpected response from OpenTok'));\n      }\n    } else {\n      callback(null);\n    }\n  });\n};","map":{"version":3,"names":["request","require","errors","pkg","_","generateJwt","api","config","method","path","body","callback","rurl","apiEndpoint","apiKey","defaults","pick","url","headers","version","uaAddendum","json","Callback","properties","hasProp","hasOwnProperty","id","key","call","unregister","exports","listCallbacks","options","ArgumentError","err","response","JSON","parse","_err","Math","floor","statusCode","AuthError","RequestError","map","item","registerCallback","group","event","apiCallback","CallbackError","unregisterCallback","callbackId","length","encodeURIComponent"],"sources":["/Users/megnabiederman/node_modules/opentok/lib/callbacks.js"],"sourcesContent":["/* global require, exports */\n/* jshint strict:false, eqnull:true */\n\nvar request = require('request');\nvar errors = require('./errors');\nvar pkg = require('../package.json');\nvar _ = require('lodash');\nvar generateJwt = require('./generateJwt');\n\nvar api = function (config, method, path, body, callback) {\n  var rurl = config.apiEndpoint + '/v2/project/' + config.apiKey + path;\n  request.defaults(_.pick(config, 'proxy', 'timeout'))({\n    url: rurl,\n    method: method,\n    headers: {\n      'X-OPENTOK-AUTH': generateJwt(config),\n      'User-Agent': 'OpenTok-Node-SDK/' + pkg.version +\n        (config.uaAddendum ? ' ' + config.uaAddendum : '')\n    },\n    json: body\n  }, callback);\n};\n\nfunction Callback(config, properties) {\n  var hasProp = {}.hasOwnProperty;\n  var id = properties.id;\n  var key;\n\n  for (key in properties) {\n    if (hasProp.call(properties, key)) this[key] = properties[key];\n  }\n\n  this.unregister = function (callback) {\n    exports.unregister(config, id, callback);\n  };\n}\n\nexports.listCallbacks = function (config, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  if (typeof callback !== 'function') {\n    throw (new errors.ArgumentError('No callback given to listCallbacks'));\n  }\n  api(config, 'GET', '/callback', null, function (err, response, body) {\n    if (!err && body) {\n      try {\n        body = JSON.parse(body);\n      }\n      catch (_err) {\n        err = _err;\n      }\n    }\n    if (err || Math.floor(response.statusCode / 100) !== 2) {\n      if (response && response.statusCode === 403) {\n        callback(new errors.AuthError('Invalid API key or secret'));\n      }\n      else {\n        callback(new errors.RequestError('Unexpected response from OpenTok'));\n      }\n    }\n    else {\n      callback(null, body.map(function (item) {\n        return new Callback(config, item);\n      }));\n    }\n  });\n};\n\nexports.registerCallback = function (config, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  if (typeof callback !== 'function') {\n    throw (new errors.ArgumentError('No callback given to registerCallback'));\n  }\n  api(config, 'POST', '/callback', {\n    group: options.group,\n    event: options.event,\n    url: options.url\n  }, function apiCallback(err, response, body) {\n    if (err) {\n      callback(err);\n    }\n    else if (Math.floor(response.statusCode / 100) !== 2) {\n      if (response && response.statusCode === 404) {\n        callback(new errors.CallbackError('Callback event not found'));\n      }\n      else if (response && response.statusCode === 403) {\n        callback(new errors.AuthError('Invalid API key or secret'));\n      }\n      else {\n        callback(new errors.RequestError('Unexpected response from OpenTok'));\n      }\n    }\n    else {\n      callback(null, new Callback(config, body));\n    }\n  });\n};\n\nexports.unregisterCallback = function (config, callbackId, callback) {\n  if (typeof callback !== 'function') {\n    throw (new errors.ArgumentError('No callback given to unregisterCallback'));\n  }\n  if (callbackId == null || callbackId.length === 0) {\n    callback(new errors.ArgumentError('No callback ID given'));\n    return;\n  }\n  api(\n    config, 'DELETE', '/callback/' + encodeURIComponent(callbackId), {},\n    function (err, response) {\n      if (err) {\n        callback(err);\n      }\n      else if (Math.floor(response.statusCode / 100) !== 2) {\n        if (response && response.statusCode === 404) {\n          callback(new errors.CallbackError('Callback not found'));\n        }\n        else if (response && response.statusCode === 403) {\n          callback(new errors.AuthError('Invalid API key or secret'));\n        }\n        else {\n          callback(new errors.RequestError('Unexpected response from OpenTok'));\n        }\n      }\n      else {\n        callback(null);\n      }\n    }\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}